{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "BreathOfNowDailyPost",
  "type": "object",
  "additionalProperties": false,

  "properties": {
    "date": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "weekday": { "type": "string", "minLength": 3 },
    "tradition": { "type": "string", "enum": ["Zen", "Tao", "Stoic"] },
    "timezone": {
      "type": "string",
      "pattern": "^[A-Za-z_]+\\/[A-Za-z_]+(?:\\/[A-Za-z_]+)?$"
    },

    "language": { "type": "string", "minLength": 2, "maxLength": 8 },
    "season": { "type": "string", "minLength": 2, "maxLength": 40 },
    "monthly_theme": { "type": "string", "minLength": 2, "maxLength": 120 },

    "quote_text": { "type": "string", "minLength": 3, "maxLength": 260 },
    "quote_author": { "type": "string", "minLength": 2, "maxLength": 80 },

    "med1": { "type": "string", "minLength": 10, "maxLength": 500 },
    "med2": { "type": "string", "minLength": 10, "maxLength": 500 },

    "jp1": { "type": "string", "minLength": 5, "maxLength": 120 },
    "jp2": { "type": "string", "minLength": 5, "maxLength": 120 },

    "cta_line": { "type": "string", "minLength": 5, "maxLength": 140 },

    "carousel_caption": { "type": "string", "minLength": 10, "maxLength": 600 },
    "carousel_hashtags": {
      "type": "array",
      "minItems": 10,
      "maxItems": 15,
      "items": { "type": "string", "minLength": 2, "maxLength": 40 },
      "uniqueItems": true
    },
    "carousel_first_comment": { "type": "string", "minLength": 5, "maxLength": 500 },
    "story_action": { "type": "string", "minLength": 5, "maxLength": 140 },

    "poem_text": { "type": "string", "minLength": 20, "maxLength": 900 },
    "poem_caption": { "type": "string", "minLength": 10, "maxLength": 600 },
    "poem_first_comment": { "type": "string", "minLength": 5, "maxLength": 500 },
    "poem_story_action": { "type": "string", "minLength": 5, "maxLength": 140 },

    "image_prompt": { "type": "string", "minLength": 10, "maxLength": 180 },
    "image_caption": { "type": "string", "minLength": 10, "maxLength": 600 },
    "image_first_comment": { "type": "string", "minLength": 5, "maxLength": 500 },
    "image_story_action": { "type": "string", "minLength": 5, "maxLength": 140 },

    "carousel": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "caption": { "type": "string", "minLength": 10, "maxLength": 600 },
        "hashtags": {
          "type": "array",
          "minItems": 10,
          "maxItems": 15,
          "items": { "type": "string", "minLength": 2, "maxLength": 40 },
          "uniqueItems": true
        },
        "first_comment": { "type": "string", "minLength": 5, "maxLength": 500 },
        "story_action": { "type": "string", "minLength": 5, "maxLength": 140 }
      },
      "patternProperties": {
        "^slide_[1-9][0-9]*$": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "quote": { "type": "string", "minLength": 3, "maxLength": 260 },
            "attribution": { "type": "string", "minLength": 2, "maxLength": 80 },
            "meditation": { "type": "string", "minLength": 10, "maxLength": 700 },
            "journal_prompt": { "type": "string", "minLength": 5, "maxLength": 160 },
            "cta": { "type": "string", "minLength": 3, "maxLength": 160 },
            "image_prompt": { "type": "string", "minLength": 10, "maxLength": 180 }
          }
        }
      }
    },

    "poem_post": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "text": { "type": "string", "minLength": 20, "maxLength": 900 },
        "poem": { "type": "string", "minLength": 20, "maxLength": 900 },
        "caption": { "type": "string", "minLength": 10, "maxLength": 600 },
        "first_comment": { "type": "string", "minLength": 5, "maxLength": 500 },
        "story_action": { "type": "string", "minLength": 5, "maxLength": 140 }
      },
      "allOf": [
        { "anyOf": [ { "required": ["text"] }, { "required": ["poem"] } ] },
        { "required": ["caption", "first_comment", "story_action"] }
      ]
    },

    "single_image_post": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "prompt": { "type": "string", "minLength": 10, "maxLength": 180 },
        "image_prompt": { "type": "string", "minLength": 10, "maxLength": 180 },
        "caption": { "type": "string", "minLength": 10, "maxLength": 600 },
        "first_comment": { "type": "string", "minLength": 5, "maxLength": 500 },
        "story_action": { "type": "string", "minLength": 5, "maxLength": 140 }
      },
      "allOf": [
        { "anyOf": [ { "required": ["prompt"] }, { "required": ["image_prompt"] } ] },
        { "required": ["caption", "first_comment", "story_action"] }
      ]
    }
  },

  "oneOf": [
    {
      "title": "Legacy flat payload",
      "required": [
        "date","weekday","tradition","timezone",
        "quote_text","quote_author","med1","med2","jp1","jp2","cta_line",
        "carousel_caption","carousel_hashtags","carousel_first_comment","story_action",
        "poem_text","poem_caption","poem_first_comment","poem_story_action",
        "image_prompt","image_caption","image_first_comment","image_story_action"
      ],
      "not": {
        "anyOf": [
          { "required": ["carousel"] },
          { "required": ["poem_post"] },
          { "required": ["single_image_post"] }
        ]
      }
    },
    {
      "title": "Modern nested payload",
      "required": [
        "date","weekday","tradition","timezone",
        "quote_text","quote_author","med1","med2","jp1","jp2","cta_line",
        "carousel","poem_post","single_image_post"
      ],
      "allOf": [
        { "not": { "required": ["carousel_caption"] } },
        { "not": { "required": ["carousel_hashtags"] } },
        { "not": { "required": ["carousel_first_comment"] } },
        { "not": { "required": ["story_action"] } },
        { "not": { "required": ["poem_text"] } },
        { "not": { "required": ["poem_caption"] } },
        { "not": { "required": ["poem_first_comment"] } },
        { "not": { "required": ["poem_story_action"] } },
        { "not": { "required": ["image_prompt"] } },
        { "not": { "required": ["image_caption"] } },
        { "not": { "required": ["image_first_comment"] } },
        { "not": { "required": ["image_story_action"] } }
      ]
    }
  ]
}
